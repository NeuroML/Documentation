(userdocs:visualising_models)=
# Visualising NeuroML Models

A number of the {ref}`NeuroML software tools <userdocs:software>` can be used to easily visualise models described in NeuroML.

(userdoc:visualising_models:pyNeuroML_cli)
## Using pyNeuroML on the command line

{ref}`pyNeuroML <pyneuroml>` includes a number of command line tools, some of which are useful for quickly obtaining information about the specified NeuroML model.

(userdoc:visualising_models:pynml_summary)=
### Get a quick summary with pynml-summary

You can get a quick summary of your NeuroML model using `pynml-summary`:

```{code-block} console
Usage:
pynml-summary <NeuroML file>
```

For example, to get a quick summary of the [Primary Auditory Cortex model by Dave Beeman](https://github.com/OpenSourceBrain/ACnet2/blob/master/neuroConstruct/generatedNeuroML2/MediumNet.net.nml) (see it [here on Open Source Brain](https://www.opensourcebrain.org/projects/acnet2)), one can run:
```{code-block} console
pynml-summary MediumNet.net.nml

*******************************************************
* NeuroMLDocument: network_ACnet2
*
*  PulseGenerator: ['BackgroundRandomIClamps']
*
*  Network: network_ACnet2 (temperature: 6.3 degC)
*
*   60 cells in 2 populations
*     Population: baskets_12 with 12 components of type bask
*       Locations: [(372.5585, 75.3425, 459.2106), ...]
*       Properties: color=0.0 0.19921875 0.59765625;
*     Population: pyramidals_48 with 48 components of type pyr_4_sym
*       Locations: [(64.2564, 0.6838, 94.8305), ...]
*       Properties: color=0.796875 0.0 0.0;
*
*   984 connections in 4 projections
*     Projection: SmallNet_bask_bask from baskets_12 to baskets_12, synapse: GABA_syn_inh
*       60 connections: [(Connection 0: 3:0(0.41661) -> 0:0(0.68577)), ...]
*     Projection: SmallNet_bask_pyr from baskets_12 to pyramidals_48, synapse: GABA_syn
*       336 connections: [(Connection 0: 10:0(0.05824) -> 0:6(0.02628)), ...]
*     Projection: SmallNet_pyr_bask from pyramidals_48 to baskets_12, synapse: AMPA_syn_inh
*       252 connections: [(Connection 0: 1:0(0.89734) -> 0:1(0.09495)), ...]
*     Projection: SmallNet_pyr_pyr from pyramidals_48 to pyramidals_48, synapse: AMPA_syn
*       336 connections: [(Connection 0: 14:0(0.52814) -> 0:3(0.10797)), ...]
*
*   14 inputs in 1 input lists
*     Input list: BackgroundRandomIClamps to pyramidals_48, component BackgroundRandomIClamps
*       14 inputs: [(Input 0: 37:0(0.500000)), ...]
*
*******************************************************
```

(userdoc:visualising_models:pynml_png)=
### View the 3D structure of the model using pynml

You can generate an image of the 3D structure of the NeuroML model using `pynml`:

```{code-block} console
Usage:
pynml -png/-svg <NeuroML file>
```

For example, to generate a PNG image of the Auditory Cortex model used above, we can use (use `-svg` to generate a vectorised SVG image instead of a PNG):

```{code-block} console
pynml -png MediumNet.net.nml
```

This generates the following image showing different views of the network :

```{figure} ../images/Acnet-medium.net.png
:alt: Graphical view of the Auditory Cortex model generated with pynml
:align: center
:scale: 20 %

Graphical view of the Auditory Cortex model generated with pynml
```

```{admonition} Open Source Brain uses NeuroML.
:class: tip
The [Open Source Brain platform](https://www.opensourcebrain.org) generates the interactive visualisations from NeuroML sources.
See the Auditory Cortex model on Open Source Brain [here](https://www.opensourcebrain.org/projects/acnet2).
```


(userdoc:visualising_models:pynml_graph)=
### View the connectivity graph of the model using pynml

You can generate an image of the 3D structure of the NeuroML model using `pynml`:

```{code-block} console
Usage:
pynml <NeuroML file> -graph <level, engine> 
```

For example, to generate a PNG image of the Auditory Cortex model used above, we can use:

```{code-block} console
pynml MediumNet.net.nml -graph 1d
```

This generates the following image showing different views of the network :

```{figure} ../images/Acnet-medium-graph-level1.png
:alt: Level 1 network graph generated by pynml
:align: center

Level 1 network graph generated by pynml
```

You can modify the level of detail included in the graph by using different values of levels.
For example, this command generates a level 5 graph:

```{code-block} console
pynml MediumNet.net.nml -graph 5d
```

```{figure} ../images/Acnet-medium-graph-level5.png
:alt: Level 5 network graph generated by pynml
:align: center
:scale: 60 %

Level 5 network graph generated by pynml
```

(userdoc:visualising_models:pynml_matrix)=
### View the connectivity matrices of the model using pynml

You can generate the connectivity matrices of projections between neuronal populations of the NeuroML model using `pynml`:

```{code-block} console
Usage:
pynml <NeuroML file> -matrix <level>
```

For example, to generate a PNG image of the connectivity matrices in the Auditory Cortex model used above, we can use:

```{code-block} console
pynml MediumNet.net.nml -matrix 1
```

This generates the following images showing different views of the connectivity matrices in the network :

```{figure} ../images/Acnet-matrix-1.png
:alt: Connectivity matrix generated by pynml - sum of signed weights
:align: center
:scale: 50 %

Connectivity matrix generated by pynml: sum of signed weights
```

```{figure} ../images/Acnet-matrix-2.png
:alt: Connectivity matrix generated by pynml - average magnitude of conductance received by post-synaptic neurons
:align: center
:scale: 50 %

Connectivity matrix generated by pynml: average conduction received by post-synaptic neurons
```

```{figure} ../images/Acnet-matrix-3.png
:alt: Connectivity matrix generated by pynml - number of connections
:align: center
:scale: 50 %

Connectivity matrix generated by pynml: number of connections
```

```{figure} ../images/Acnet-matrix-4.png
:alt: Connectivity matrix generated by pynml - average conductance received by post-synaptic neurons
:align: center
:scale: 50 %

Connectivity matrix generated by pynml: average conductance received by post-synaptic neurons
```

```{figure} ../images/Acnet-matrix-5.png
:alt: Connectivity matrix generated by pynml - average weight per connection
:align: center
:scale: 50 %

Connectivity matrix generated by pynml- average weight per connection
```

(userdoc:visualising_models:pynml_lemsgraph)=
### View graph of the simulation instance of the model using pynml

When you have created a simulation instance of the NeuroML model using LEMS, you can also visualise this using `pynml`:

```{code-block} console
Usage:
pynml <LEMS simulation file> -lems-graph
```

For example, to generate a PNG image of [LEMS simulation instance](https://github.com/OpenSourceBrain/ACnet2/blob/master/neuroConstruct/generatedNeuroML2/LEMS_MediumNet.xml) of the Auditory Cortex model used above, we can use:

```{code-block} console
pynml LEMS_MediumNet.xml -lems-graph
```

This generates {download}`this image <../images/Acnet-LEMS.png>` (please click to open: it is too large to display in the page).
